<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Chroma OS: Crystal Desktop</title>
    <style>
        * {
            box-sizing: border-box;
            user-select: none;
            font-family: 'Segoe UI', sans-serif;
        }

        body {
            margin: 0;
            height: 100vh;
            overflow: hidden;
            background: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop') no-repeat center center/cover;
        }

        /* Taskbar */
        #taskbar {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            height: 52px;
            width: auto;
            min-width: 400px;
            background: rgba(30, 30, 30, 0.75);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 99999;
        }

        .task-icon {
            width: 42px;
            height: 42px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            position: relative;
            cursor: pointer;
        }

        .task-icon:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
        }

        .task-icon img {
            width: 26px;
            height: 26px;
        }

        .task-icon.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            width: 6px;
            height: 3px;
            background: #00e0ff;
            border-radius: 2px;
        }

        /* Tray Area */
        #tray {
            margin-left: auto;
            display: flex;
            gap: 15px;
            align-items: center;
            padding-right: 15px;
            color: white;
            font-size: 13px;
            position: absolute;
            bottom: 10px;
            right: 20px;
            background: rgba(30, 30, 30, 0.6);
            backdrop-filter: blur(20px);
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Start Menu */
        #start-menu {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
            pointer-events: none;
            width: 640px;
            height: 480px;
            background: rgba(30, 30, 35, 0.9);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            transition: 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
            display: flex;
            flex-direction: column;
            z-index: 99998;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
        }

        #start-menu.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
            pointer-events: all;
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .app-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .app-icon {
            width: 52px;
            height: 52px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: transform 0.1s;
            position: relative;
        }

        .app-item:hover .app-icon {
            transform: scale(1.05);
        }

        .app-item span {
            color: #ccc;
            font-size: 11px;
            text-align: center;
        }

        /* Window System */
        .window {
            position: absolute;
            min-width: 400px;
            min-height: 250px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            display: flex;
            flex-direction: column;
            opacity: 0;
            transform: scale(0.95);
            transition: transform 0.1s, opacity 0.1s;
        }

        .window.visible {
            opacity: 1;
            transform: scale(1);
        }

        .window.maximized {
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            border-radius: 0;
        }

        .window.minimized {
            opacity: 0;
            transform: scale(0.8) translateY(200px);
            pointer-events: none;
        }

        .title-bar {
            height: 38px;
            background: #222;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            border-radius: 8px 8px 0 0;
            border-bottom: 1px solid #000;
        }

        .window.maximized .title-bar {
            border-radius: 0;
        }

        .drag-area {
            flex: 1;
            height: 100%;
            display: flex;
            align-items: center;
            font-size: 13px;
            color: #ccc;
            font-weight: 500;
        }

        .controls {
            display: flex;
            gap: 8px;
        }

        .btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            cursor: pointer;
        }

        .cl {
            background: #ff5f57;
        }

        .mi {
            background: #febc2e;
        }

        .ma {
            background: #28c840;
        }

        .win-content {
            flex: 1;
            background: #111;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .console {
            font-family: 'Consolas', monospace;
            color: #ddd;
            font-size: 13px;
            padding: 10px;
            overflow-y: auto;
            flex: 1;
        }

        .resizer {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 15px;
            height: 15px;
            cursor: se-resize;
        }

        /* Terminal UI */
        .terminal-layout {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: #0c0c0c;
            padding: 10px;
            font-family: 'Consolas', monospace;
            color: #ccc;
            font-size: 14px;
            cursor: text;
        }

        .terminal-output {
            flex: 1;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-bottom: 5px;
        }

        .terminal-input-line {
            display: flex;
            align-items: center;
        }

        .cmd-prompt {
            color: #ccc;
            margin-right: 8px;
        }

        .cmd-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #ccc;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            outline: none;
        }

        /* Browser UI */
        .browser-layout {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: #202124;
        }

        .browser-toolbar {
            height: 48px;
            background: #202020;
            display: flex;
            align-items: center;
            padding: 0 10px;
            gap: 10px;
            border-bottom: 1px solid #333;
        }

        .browser-btn {
            color: #aaa;
            font-size: 16px;
            cursor: pointer;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .browser-btn:hover {
            background: #333;
            color: white;
        }

        .url-bar {
            flex: 1;
            height: 32px;
            background: #101010;
            border: 1px solid #333;
            border-radius: 16px;
            color: white;
            padding: 0 15px;
            display: flex;
            align-items: center;
            font-size: 13px;
        }

        .url-input {
            background: transparent;
            border: none;
            color: white;
            width: 100%;
            outline: none;
        }

        .browser-viewport {
            flex: 1;
            background: white;
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }

        .browser-viewport.dark {
            background: #1a1a1a;
            color: white;
        }

        /* Settings App CSS */
        .settings-layout {
            display: flex;
            flex-direction: column;
            height: 100%;
            color: #fff;
        }

        .settings-header {
            padding: 20px;
            border-bottom: 1px solid #333;
            background: #1a1a1a;
        }

        .settings-search {
            width: 100%;
            padding: 10px 15px;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 6px;
            color: white;
            font-size: 14px;
            outline: none;
        }

        .settings-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .setting-group {
            margin-bottom: 25px;
        }

        .group-title {
            font-size: 12px;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #222;
            margin-bottom: 1px;
            cursor: pointer;
        }

        .s-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .s-name {
            font-size: 14px;
            font-weight: 500;
        }

        .s-desc {
            font-size: 12px;
            color: #aaa;
        }

        .s-val {
            color: #00adef;
            font-size: 13px;
        }

        .hidden-item {
            display: none !important;
        }

        /* Log Colors */
        .c-cyan {
            color: #00ffff;
        }

        .c-green {
            color: #00ff00;
        }

        .c-yellow {
            color: #ffff00;
        }

        /* Power Menu CSS */
        .start-footer {
            margin-top: auto;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
        }

        .user-profile:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: #0078D4;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .power-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
        }

        .power-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .power-menu {
            position: absolute;
            bottom: 50px;
            right: 20px;
            background: #2b2b2b;
            border: 1px solid #444;
            border-radius: 6px;
            padding: 5px;
            display: none;
            flex-direction: column;
            min-width: 150px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            z-index: 99999;
        }

        .power-menu.visible {
            display: flex;
        }

        .power-item {
            padding: 10px 15px;
            display: flex;
            gap: 10px;
            align-items: center;
            cursor: pointer;
            color: white;
            font-size: 13px;
            border-radius: 4px;
        }

        .power-item:hover {
            background: #3a3a3a;
        }

        /* Shutdown Overlay */
        #black-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 1000000;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
        }
    </style>
</head>

<body>

    <!-- Shutdown Overlay -->
    <div id="black-screen">
        <div
            style="width: 50px; height: 50px; border: 3px solid transparent; border-top: 3px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;">
        </div>
        <div id="bs-text" style="font-family: 'Segoe UI Light', sans-serif; font-size: 24px;">Shutting down</div>
    </div>

    <!-- Start Menu -->
    <div id="start-menu">
        <input type="text"
            style="width:100%; padding:12px; background:#222; border:1px solid #444; color:white; border-radius:6px; font-size:14px;"
            placeholder="Search apps, files, and settings...">

        <div class="app-grid">
            <div class="app-item" onclick="spawnApp('browser')">
                <div class="app-icon" style="background:#fff">
                    <div
                        style="width:30px;height:30px;background:conic-gradient(#EA4335 0deg 90deg, #34A853 90deg 180deg, #FBBC05 180deg 270deg, #4285F4 270deg 360deg);border-radius:50%;">
                    </div>
                </div><span>Chroma Surf</span>
            </div>
            <div class="app-item" onclick="spawnApp('windows')">
                <div class="app-icon" style="background:#0078D4">ü™ü</div><span>Windows</span>
            </div>
            <div class="app-item" onclick="spawnApp('android')">
                <div class="app-icon" style="background:#3DDC84">ü§ñ</div><span>Android</span>
            </div>
            <div class="app-item" onclick="spawnApp('ios')">
                <div class="app-icon" style="background:#000">üçé</div><span>iOS</span>
            </div>
            <div class="app-item" onclick="spawnApp('settings')">
                <div class="app-icon" style="background:#555">‚öôÔ∏è</div><span>Settings</span>
            </div>
            <div class="app-item" onclick="spawnApp('term')">
                <div class="app-icon" style="background:#333">üíª</div><span>Terminal</span>
            </div>
            <div class="app-item" onclick="spawnApp('files')">
                <div class="app-icon" style="background:#E6C045">ÔøΩ</div><span>Seeds</span>
            </div>
        </div>

        <div class="start-footer">
            <div class="user-profile">
                <div class="user-avatar">A</div>
                <div style="font-size:13px; color:#ddd;">Admin User</div>
            </div>
            <div class="power-btn" onclick="togglePowerMenu(event)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                    <path
                        d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z" />
                </svg>
                <div class="power-menu" id="pwr-menu">
                    <div class="power-item" onclick="sysPower('sleep')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                            <path
                                d="M10 2c-1.82 0-3.53.5-5 1.35C7.99 5.08 10 8.3 10 12s-2.01 6.92-5 8.65C6.47 21.5 8.18 22 10 22c5.52 0 10-4.48 10-10S15.52 2 10 2z" />
                        </svg>
                        Sleep
                    </div>
                    <div class="power-item" onclick="sysPower('shutdown')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                            <path
                                d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z" />
                        </svg>
                        Shut down
                    </div>
                    <div class="power-item" onclick="sysPower('restart')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                            <path
                                d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
                        </svg>
                        Restart
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Desktop Area -->
    <div id="desktop-area" style="position:absolute; top:0; left:0; width:100%; height:100%; z-index:1;"></div>

    <!-- Taskbar -->
    <div id="taskbar">
        <div class="task-icon" onclick="toggleStart()" title="Start">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M4 4h7v7H4V4zm0 9h7v7H4v-7zm9-9h7v7h-7V4zm0 9h7v7h-7v-7z" fill="#00aaff" />
            </svg>
        </div>
        <div style="width:1px; height:24px; background:rgba(255,255,255,0.1); margin:0 8px;"></div>
        <div id="taskbar-apps" style="display:flex; gap:8px;"></div>
    </div>

    <!-- Tray -->
    <div id="tray">
        <div style="display:flex;gap:5px;align-items:center;" title="Network: Connected">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                <path
                    d="M12 2C7.95 2 4.21 3.34 1.16 5.61L12 18.92L22.84 5.61C19.79 3.34 16.05 2 12 2ZM12 4C15.55 4 18.83 5.15 21.5 7.15L12 18.8L2.5 7.15C5.17 5.15 8.45 4 12 4Z" />
            </svg>
            <span>Wi-Fi 6E</span>
        </div>
        <div title="Volume: 80%">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                <path
                    d="M3 9V15H7L12 20V4L7 9H3ZM16.5 12C16.5 10.23 15.48 8.71 14 7.97V16.02C15.48 15.29 16.5 13.77 16.5 12ZM14 3.23V5.29C16.89 6.15 19 8.83 19 12C19 15.17 16.89 17.85 14 18.71V20.77C18.01 19.86 21 16.28 21 12C21 7.72 18.01 4.14 14 3.23Z" />
            </svg>
        </div>
        <div><span id="clock">12:00</span></div>
    </div>

    <script>
        let zIndexCounter = 100;
        const windows = {};
        const taskbarApps = document.getElementById('taskbar-apps');

        // Apps Definition
        const apps = {
            'windows': { icon: 'ü™ü', color: '#0078D4', title: 'Synthesizer: Windows' },
            'android': { icon: 'ü§ñ', color: '#3DDC84', title: 'Synthesizer: Android' },
            'ios': { icon: 'üçé', color: '#fff', title: 'Synthesizer: iOS' },
            'settings': { icon: '‚öôÔ∏è', color: '#555', title: 'System Settings' },
            'term': { icon: 'üíª', color: '#444', title: 'Chroma Terminal' },
            'files': { icon: 'üìÅ', color: '#E6C045', title: 'Fractal Seed Explorer' },
            'browser': { icon: 'üåê', color: '#4285F4', title: 'Chroma Surf' },
        };

        function toggleStart() { document.getElementById('start-menu').classList.toggle('show'); }
        document.addEventListener('mousedown', (e) => {
            if (!document.getElementById('start-menu').contains(e.target) && !document.getElementById('taskbar').contains(e.target))
                document.getElementById('start-menu').classList.remove('show');
        });

        function togglePowerMenu(e) {
            e.stopPropagation();
            document.getElementById('pwr-menu').classList.toggle('visible');
        }

        function sysPower(action) {
            document.getElementById('start-menu').classList.remove('show');
            const screen = document.getElementById('black-screen');
            const text = document.getElementById('bs-text');

            screen.style.display = "flex";

            if (action === 'shutdown') {
                text.innerText = "Shutting down...";
                setTimeout(() => { document.body.innerHTML = ''; document.body.style.background = 'black'; }, 3000);
            }
            else if (action === 'restart') {
                text.innerText = "Restarting...";
                setTimeout(() => { location.reload(); }, 3000);
            }
            else if (action === 'sleep') {
                text.innerText = ""; // Just fade to black
                setTimeout(() => {
                    // Simulate Wake on click
                    screen.innerHTML = "<div style='color:white; font-size:14px;'>Click to wake up</div>";
                    screen.onclick = () => { screen.style.display = 'none'; screen.onclick = null; };
                }, 2000);
            }
        }

        // --- WINDOW MANAGER CORE ---

        function spawnApp(appId) {
            document.getElementById('start-menu').classList.remove('show');

            const id = 'win_' + Date.now();
            const appDef = apps[appId];

            // Create DOM
            const win = document.createElement('div');
            win.className = 'window';
            win.id = id;
            win.onmousedown = () => focusWindow(id); // Click to bring to front (Mac style)
            win.style.left = (100 + (Math.random() * 50)) + 'px';
            win.style.top = (80 + (Math.random() * 50)) + 'px';
            win.style.width = appId === 'browser' ? '900px' : (appId === 'settings' ? '700px' : '600px');
            win.style.height = appId === 'browser' ? '600px' : '450px';
            win.style.zIndex = ++zIndexCounter;

            win.innerHTML = `
            <div class="title-bar">
                <div class="drag-area" onmousedown="startDrag(event, '${id}')">
                    <span style="margin-right:8px;">${appDef.icon}</span> ${appDef.title}
                </div>
                <div class="controls">
                    <div class="btn mi" onclick="minimizeWindow('${id}')"></div>
                    <div class="btn ma" onclick="maximizeWindow('${id}')"></div>
                    <div class="btn cl" onclick="closeWindow('${id}')"></div>
                </div>
            </div>
            <div class="win-content" id="content_${id}">
                ${getAppContent(appId, id)}
                <div class="resizer" onmousedown="initResize(event, '${id}')"></div>
            </div>
        `;

            document.getElementById('desktop-area').appendChild(win);

            const taskIcon = document.createElement('div');
            taskIcon.className = 'task-icon running active';
            taskIcon.id = 'task_' + id;
            taskIcon.innerHTML = appDef.icon;
            taskIcon.onclick = () => focusWindow(id);
            taskbarApps.appendChild(taskIcon);

            windows[id] = { element: win, taskIcon: taskIcon, minimized: false, maximized: false };
            requestAnimationFrame(() => win.classList.add('visible'));

            if (appId === 'windows' || appId === 'android' || appId === 'ios' || appId === 'term' || appId === 'files') {
                runOSSimulation(id, appId);
            }
        }

        function closeWindow(id) {
            if (!windows[id]) return;
            windows[id].element.style.opacity = '0';
            setTimeout(() => windows[id].element.remove(), 150);
            windows[id].taskIcon.remove();
            delete windows[id];
        }
        function minimizeWindow(id) { windows[id].minimized = true; windows[id].element.classList.add('minimized'); windows[id].taskIcon.classList.remove('active'); }
        function maximizeWindow(id) { windows[id].maximized = !windows[id].maximized; windows[id].element.classList.toggle('maximized'); }
        function focusWindow(id) {
            windows[id].minimized = false; windows[id].element.classList.remove('minimized'); windows[id].element.style.zIndex = ++zIndexCounter;
            document.querySelectorAll('.task-icon').forEach(el => el.classList.remove('active')); windows[id].taskIcon.classList.add('active');
        }

        // --- APP CONTENT FACTORY ---
        function getAppContent(type, id) {
            if (type === 'settings') return getSettingsHTML(id);
            if (type === 'browser') return getBrowserHTML(id);
            if (type === 'term') return getTerminalHTML(id);
            return `<div class="console" id="con_${id}"></div>`;
        }

        // --- TERMINAL LOGIC ---
        function getTerminalHTML(id) {
            return `
            <div class="terminal-layout" onclick="document.getElementById('input_${id}').focus()">
                <div class="terminal-output" id="output_${id}">
                    <div>Chroma OS Shell [Version 5.0.2]</div>
                    <div>(c) 2026 Antigravity Corp. All rights reserved.</div>
                    <br>
                </div>
                <div class="terminal-input-line">
                    <span class="cmd-prompt">C:\\Users\\Admin&gt;</span>
                    <input type="text" id="input_${id}" class="cmd-input" autocomplete="off" onkeydown="handleCmd(event, '${id}')">
                </div>
            </div>
        `;
        }

        function handleCmd(e, id) {
            if (e.key !== 'Enter') return;

            const input = document.getElementById(`input_${id}`);
            const output = document.getElementById(`output_${id}`);
            const cmdRaw = input.value;
            const cmd = cmdRaw.trim().toLowerCase();

            // Append previous command
            const line = document.createElement('div');
            line.innerHTML = `<span>C:\\Users\\Admin&gt;</span> ${cmdRaw}`;
            output.appendChild(line);
            input.value = '';

            // Process Command
            const res = document.createElement('div');
            res.style.marginBottom = "10px";

            if (cmd === 'help') {
                res.innerHTML = `
    Available Commands:
      HELP     Show this help message
      VER      Display system version
      CLS      Clear the screen
      DIR      List directory contents
      DATE     Display current date
      SYNTH    Synthesize OS (Usage: synth windows)
      EXIT     Close this session
            `;
            }
            else if (cmd === 'ver') { res.innerText = "Chroma OS [Version 5.0.2] - Fractal Singularity Edition"; }
            else if (cmd === 'cls' || cmd === 'clear') { output.innerHTML = ''; res.remove(); } // Clear and allow prompt to stay
            else if (cmd === 'date') { res.innerText = new Date().toString(); }
            else if (cmd === 'dir' || cmd === 'ls') {
                res.innerHTML = `
    Directory of C:\\Users\\Admin

    ${new Date().toLocaleDateString()}  <DIR>          .
    ${new Date().toLocaleDateString()}  <DIR>          ..
    ${new Date().toLocaleDateString()}  <DIR>          Documents
    ${new Date().toLocaleDateString()}  <DIR>          Downloads
    ${new Date().toLocaleDateString()}      58,402,110 windows_11.math
    ${new Date().toLocaleDateString()}      32,109,442 android_15.math
    ${new Date().toLocaleDateString()}      45,998,221 ios_19.math
                   3 File(s)    136,509,773 bytes
                   4 Dir(s)     4,096,000,000,000 bytes free`;
            }
            else if (cmd.startsWith('synth')) {
                const args = cmd.split(' ');
                if (args.length < 2) res.innerText = "Usage: synth [windows|android|ios]";
                else {
                    const target = args[1];
                    if (['windows', 'android', 'ios'].includes(target)) {
                        res.innerHTML = `<span style="color:#00ff00;">Initiating synthesis for ${target.toUpperCase()}...</span><br>See graphical window for output.`;
                        spawnApp(target);
                    } else res.innerText = `Unknown target genome: ${target}`;
                }
            }
            else if (cmd === 'exit') { closeWindow(id); return; }
            else if (cmd === '') { /* Do nothing */ }
            else {
                res.innerText = `'${cmd}' is not recognized as an internal or external command, operable program or batch file.`;
            }

            if (cmd !== 'cls' && cmd !== 'clear') output.appendChild(res);

            // Scroll to bottom
            output.scrollTop = output.scrollHeight;
        }

        // --- BROWSER LOGIC ---
        function getBrowserHTML(id) {
            return `
            <div class="browser-layout">
                <div class="browser-toolbar">
                    <div class="browser-btn">‚Üê</div>
                    <div class="browser-btn">‚Üí</div>
                    <div class="browser-btn" onclick="browse('${id}', 'refresh')">‚Üª</div>
                    <div class="url-bar">
                        <input type="text" class="url-input" id="url_${id}" value="chroma://welcome" onkeydown="if(event.key==='Enter') browse('${id}')">
                    </div>
                </div>
                <div class="browser-viewport" id="view_${id}">
                    <center style="margin-top:100px;">
                        <h1 style="color:#222; font-size:48px;">Chroma Surf</h1>
                        <p style="color:#666;">The Fractal Web Browser</p>
                    </center>
                </div>
            </div>
        `;
        }

        window.browse = function (id, action) {
            const urlInput = document.getElementById('url_' + id);
            let url = urlInput.value;
            if (action === 'refresh') url = urlInput.value;

            const view = document.getElementById('view_' + id);
            view.innerHTML = '<div style="padding:20px; color:black;">Loading...</div>';

            setTimeout(() => {
                if (url.includes('google')) view.innerHTML = '<h2 style="color:#222; padding:20px;">Google (Simulated)</h2><div style="padding:20px;"><input style="padding:10px; border:1px solid #ccc; width:400px;" placeholder="Search Google"></div>';
                else if (url.includes('youtube')) view.innerHTML = '<div style="background:#f9f9f9; height:100%; padding:20px;"><div style="background:red; color:white; padding:10px 20px; display:inline-block; font-weight:bold; border-radius:4px;">YouTube</div><br><br><div style="width:200px; height:120px; background:#ddd; border-radius:8px;"></div></div>';
                else view.innerHTML = `<div style="padding:40px; text-align:center;"><h2 style="color:#4285F4;">${url}</h2><p style="color:#666;">Simulated content rendered via Holographic Engine.</p></div>`;

                view.classList.remove('dark');
                if (url.includes('dark')) { view.classList.add('dark'); view.innerHTML += '<p>Dark mode active</p>'; }
            }, 500);
        }

        // --- SETTINGS LOGIC ---
        function getSettingsHTML(id) {
            return `
            <div class="settings-layout">
                <div class="settings-header">
                    <input type="text" class="settings-search" id="search_${id}" onkeyup="filterSettings('${id}')" placeholder="Find a setting (System, Display, Battery, Privacy)...">
                </div>
                <div class="settings-body" id="list_${id}">
                    
                    ${renderSettingGroup('Connectivity (Network & Internet)', [
                { n: 'Wi-Fi', d: 'Connected to "Home_5G"', v: 'On' },
                { n: 'Bluetooth', d: 'Discoverable as "Chroma-PC"', v: 'On' },
                { n: 'Airplane Mode', d: 'Stop all wireless communication', v: 'Off' },
                { n: 'Mobile Hotspot', d: 'Share internet connection', v: 'Off' },
                { n: 'VPN & Proxy', d: 'Encrypt network traffic', v: 'Chroma VPN' },
                { n: 'NFC & Contactless', d: 'Tap to pay and tag reading', v: 'On' },
                { n: 'AirDrop / Quick Share', d: 'Share files with nearby devices', v: 'Everyone' },
            ])}

                    ${renderSettingGroup('Display & Visuals', [
                { n: 'Brightness', d: 'Adjust screen luminosity', v: '80%' },
                { n: 'Refresh Rate', d: 'ProMotion / Dynamic Refresh', v: '120 Hz' },
                { n: 'HDR Mode', d: 'High Dynamic Range video', v: 'Auto' },
                { n: 'Night Shift', d: 'Blue light filter schedule', v: 'Sunset to Sunrise' },
                { n: 'Scale & Layout', d: 'Text size and DPI scaling', v: '150% (Recommended)' },
                { n: 'Orientation', d: 'Landscape / Portrait', v: 'Auto-Rotate' },
            ])}

                    ${renderSettingGroup('Sound & Haptics', [
                { n: 'Master Volume', d: 'System outputs', v: '65%' },
                { n: 'Spatial Audio', d: 'Dolby Atmos / 360 Audio', v: 'On' },
                { n: 'Do Not Disturb', d: 'Silence notifications', v: 'Off' },
                { n: 'Haptic Feedback', d: 'System vibration intensity', v: 'Medium' },
                { n: 'Microphone Input', d: 'Studio Quality isolation', v: 'Default Mic' },
            ])}

                    ${renderSettingGroup('Gaming & Performance', [
                { n: 'Game Mode', d: 'Prioritize games', v: 'On' },
                { n: 'High Performance', d: 'Force discrete GPU usage', v: 'Active' },
                { n: 'Legacy Support', d: 'run older DirectX 9 titles', v: 'Proton Legacy' },
                { n: 'Overclocking', d: 'CPU/GPU Boost Clock', v: 'Auto-AI' },
            ])}

                    ${renderSettingGroup('Storage & Memory', [
                { n: 'Storage Sense', d: 'Auto-delete temp files', v: 'On' },
                { n: 'Virtual RAM', d: 'Swap/Pagefile size', v: '16 GB (Dynamic)' },
                { n: 'Trim & Optimize', d: 'SSD Health Maintenance', v: 'Weekly' },
                { n: 'External Drives', d: 'USB / Thunderbolt management', v: 'Auto-Mount' },
            ])}

                    ${renderSettingGroup('Privacy & Security', [
                { n: 'Biometrics', d: 'Face ID / IR Camera', v: 'Registered' },
                { n: 'Location Services', d: 'GPS & Location History', v: 'While Using App' },
                { n: 'Tracking Prevention', d: 'Blocks app trackers', v: 'Strict' },
                { n: 'Secure Enclave', d: 'Hardware-level key storage', v: 'Locked' },
                { n: 'System Protection', d: 'Real-time malware protection', v: 'Active' },
                { n: 'Disk Encryption', d: 'Full disk encryption', v: 'Zero-Knowledge Encrypted' },
            ])}

                    ${renderSettingGroup('Accessibility', [
                { n: 'Voice Control', d: 'Control device with voice', v: 'Off' },
                { n: 'Magnifier', d: 'Zoom in on screen content', v: 'Off' },
                { n: 'Color Filters', d: 'Protanopia / Deuteranopia', v: 'Off' },
                { n: 'Live Caption', d: 'Auto-caption audio/video', v: 'English (US)' },
            ])}

                    ${renderSettingGroup('Accounts & Cloud', [
                { n: 'Chroma ID', d: 'Settings sync & cloud backup', v: 'Logged In' },
                { n: 'Family Sharing', d: 'Share purchases & subs', v: 'Organizer' },
                { n: 'Passkeys', d: 'Passwordless sign-in', v: 'Managed' },
            ])}

                    ${renderSettingGroup('System & Updates', [
                { n: 'System Update', d: 'Latest build: 26000.1', v: 'Up to Date' },
                { n: 'Backup & Restore', d: 'System snapshots', v: 'Hourly' },
                { n: 'Recovery', d: 'Reset PC / Factory Reset', v: 'Ready' },
                { n: 'Developer Mode', d: 'USB Debugging / Sideload', v: 'Enabled' },
            ])}

                    ${renderSettingGroup('Fractal Core', [
                { n: 'RNS Precision', d: 'Bit-depth for state synthesis', v: '128-bit' },
                { n: 'Neural Link', d: 'P2P Fractal Network sharing', v: 'Enabled' },
                { n: 'Predictive Branching', d: 'AI Pre-calculation intensity', v: 'Ultra' },
            ])}

                    ${renderSettingGroup('Apps & Runtime Bridge', [
                { n: 'Proton Compatibility', d: 'Run desktop games/apps', v: 'Proton-GE (Active)' },
                { n: 'Waydroid Container', d: 'Run mobile apps', v: 'Native Bridge' },
                { n: 'Translation Layer', d: 'Cross-architecture support', v: 'Translating' },
                { n: 'Default Apps', d: 'Choose default browser, email, music', v: 'Chroma Defaults' },
            ])}
                </div>
            </div>
        `;
        }
        function renderSettingGroup(title, items) {
            let h = `<div class="setting-group"><div class="group-title">${title}</div>`;
            items.forEach(i => { h += `<div class="setting-item" data-text="${(i.n + ' ' + i.d).toLowerCase()}"><div class="s-info"><span class="s-name">${i.n}</span><span class="s-desc">${i.d}</span></div><div class="s-val">${i.v}</div></div>`; });
            h += `</div>`;
            return h;
        }

        window.filterSettings = function (id) {
            const term = document.getElementById('search_' + id).value.toLowerCase();
            const list = document.getElementById('list_' + id);
            for (let item of list.getElementsByClassName('setting-item')) item.classList.toggle('hidden-item', !item.dataset.text.includes(term));
        }

        // --- UTIL ---
        let dragObj = null, offX = 0, offY = 0;
        function startDrag(e, id) { focusWindow(id); if (!windows[id].maximized) { dragObj = windows[id].element; const r = dragObj.getBoundingClientRect(); offX = e.clientX - r.left; offY = e.clientY - r.top; document.addEventListener('mousemove', onDrag); document.addEventListener('mouseup', stopDrag); } }
        function onDrag(e) { if (dragObj) { dragObj.style.left = (e.clientX - offX) + 'px'; dragObj.style.top = (e.clientY - offY) + 'px'; } }
        function stopDrag() { dragObj = null; document.removeEventListener('mousemove', onDrag); document.removeEventListener('mouseup', stopDrag); }
        function initResize(e, id) { focusWindow(id); const w = windows[id].element; const sX = e.clientX, sY = e.clientY, sW = parseInt(getComputedStyle(w).width), sH = parseInt(getComputedStyle(w).height); function r(ev) { w.style.width = (sW + ev.clientX - sX) + 'px'; w.style.height = (sH + ev.clientY - sY) + 'px'; } function s() { document.removeEventListener('mousemove', r); document.removeEventListener('mouseup', s); } document.addEventListener('mousemove', r); document.addEventListener('mouseup', s); e.preventDefault(); }

        async function wait(ms) { return new Promise(r => setTimeout(r, ms)); }
        function log(id, msg) { const c = document.getElementById('con_' + id); if (c) { const d = document.createElement('div'); d.innerHTML = `> ${msg}`; c.appendChild(d); c.scrollTop = c.scrollHeight; } }

        async function runOSSimulation(id, type) {
            if (type == 'term') { log(id, "Chroma Kernel Shell v5.0"); return; }
            if (type == 'files') { log(id, "Listing Seeds..."); await wait(200); log(id, "<span class='c-yellow'>windows.math</span>"); log(id, "<span class='c-yellow'>android.math</span>"); return; }
            log(id, `Init ${type}...`); await wait(600);
            log(id, `[1/4] Loading Seed...`); await wait(800);
            log(id, `[2/4] RNS Active.`); await wait(800);
            log(id, `[3/4] Bridge Active.`); await wait(500);
            log(id, `[4/4] Visual Ready.`); await wait(500);
            log(id, `<span class='c-green'>RUNNING</span>`);
        }

        setInterval(() => { const d = new Date(); document.getElementById('clock').innerText = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); }, 1000);

    </script>
</body>

</html>